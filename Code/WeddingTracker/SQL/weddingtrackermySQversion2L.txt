/*  ---------------------------------------------------------------------------------------
	drop potential conflicting indexes and tables
 --------------------------------------------------------------------------------------- */

DROP	TABLE	IF EXISTS	PHOTOGRAPHERLOCATIONS;
DROP	TABLE	IF EXISTS	TIMECHUNKPHOTOGRAPHER;
DROP	TABLE	IF EXISTS	TIME_CHUNK;
DROP	TABLE	IF EXISTS	TIMELINE;
DROP	TABLE	IF EXISTS	ASSIGNED_STAFF;
DROP	TABLE	IF EXISTS	EVENTLOCATIONS;
DROP	TABLE	IF EXISTS	EVENT_CLIENTS;
DROP	TABLE	IF EXISTS	LOCATION;
DROP	TABLE	IF EXISTS	EVENT_PHOTOGRAPHERS;
DROP	TABLE	IF EXISTS	EVENT;
DROP	TABLE	IF EXISTS	EVENTTYPE;
DROP	TABLE	IF EXISTS	CLIENT;
DROP	TABLE	IF EXISTS	PHOTOGRAPHER;

/* ---------------------------------------------------------------------------------------
	create the database tables
 --------------------------------------------------------------------------------------- */

CREATE TABLE PHOTOGRAPHER (
	STAFFID			INT		NOT NULL		AUTO_INCREMENT,
	FIRSTNAME		VARCHAR(20)	NOT NULL,
	LASTNAME		VARCHAR(25)	NOT NULL,
	
	PRIMARY KEY (STAFFID)
);

CREATE TABLE LOCATION (
	LOCATIONID		INT		NOT NULL		AUTO_INCREMENT,
	CITY			VARCHAR(30)	NOT NULL,
	STATE			CHAR(2)		NOT NULL		DEFAULT 'OH',
	ZIP			CHAR(5)		NOT NULL,
	ADDRESS			VARCHAR(30)	NOT NULL,
	DESCRIPTION		VARCHAR(100)	NOT NULL		DEFAULT 'N/A',

	PRIMARY KEY (LOCATIONID)
);

CREATE TABLE EVENTTYPE (
	EVENTTYPEID		INT		NOT NULL		AUTO_INCREMENT,
	EVENTTYPE		VARCHAR(100)	NOT NULL		DEFAULT 'EVENT',
	BASECOST		VARCHAR(8)	DEFAULT 'N/A'		NOT NULL,

	PRIMARY KEY (EVENTTYPEID)
);

CREATE TABLE EVENT (
	EVENTID			INT		NOT NULL		AUTO_INCREMENT,
	EVENTNAME		VARCHAR(100)	NOT NULL		DEFAULT 'NAMELESS EVENT',
	TYPE			INT		NOT NULL,
	EVENTDATE		DATE		NOT NULL,
	STARTTIME		TIME		NOT NULL,
	DURATION		TIME		DEFAULT '0:00:00'	NOT NULL,
	TIMELINE		INT		DEFAULT NULL,
	MULTICLIENT		CHAR(1)		DEFAULT 'N' 		NOT NULL,
	EXTRACOST		VARCHAR(8)	DEFAULT '$0.00'		NOT NULL,		
	NOTES			TEXT,
	MULTISTAFF		CHAR(1)		DEFAULT 'N' 		NOT NULL,
	
	PRIMARY KEY (EVENTID),
	FOREIGN KEY (TYPE) REFERENCES EVENTTYPE(EVENTTYPEID) ON UPDATE CASCADE ON DELETE RESTRICT,
	CONSTRAINT CHK_MUL_CLI CHECK (MULTICLIENT = 'Y' OR MULTICLIENT = 'N')
);

CREATE TABLE EVENTLOCATIONS (
	EVENTID			INT		NOT NULL,
	LOCATIONID		INT		NOT NULL,

	PRIMARY KEY (EVENTID, LOCATIONID),
	FOREIGN KEY (EVENTID) REFERENCES EVENT(EVENTID),
	FOREIGN KEY (LOCATIONID) REFERENCES LOCATION(LOCATIONID)
);

CREATE TABLE EVENT_PHOTOGRAPHERS (
	
	EVENTID			INT		NOT NULL,
	STAFFID			INT		NOT NULL,

	PRIMARY KEY (EVENTID, STAFFID),
	FOREIGN KEY (EVENTID) REFERENCES EVENT(EVENTID) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (STAFFID) REFERENCES PHOTOGRAPHER(STAFFID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE CLIENT (
	CLIENTID		INT		NOT NULL		AUTO_INCREMENT,
	FIRSTNAME		VARCHAR(20)	NOT NULL,
	LASTNAME		VARCHAR(25)	NOT NULL,
	ADDRESS			VARCHAR(100)	NOT NULL,
	PHONENUMBER		CHAR(14)	NOT NULL,
	EMAIL			VARCHAR(50),
	AUTOREMIND		CHAR(1)		NOT NULL		DEFAULT 'N',

	PRIMARY KEY (CLIENTID)
);

CREATE TABLE EVENT_CLIENTS (
	EVENTID			INT		NOT NULL,
	CLIENTID		INT		NOT NULL,
	
	PRIMARY KEY (EVENTID, CLIENTID),
	FOREIGN KEY (EVENTID) REFERENCES EVENT(EVENTID) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (CLIENTID) REFERENCES CLIENT(CLIENTID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE TIMELINE (
	TIMELINEID		INT		NOT NULL		AUTO_INCREMENT,
	STARTTIME		TIME		NOT NULL,
	TOTALTIME		TIME		NOT NULL		DEFAULT '0:0:0',

	PRIMARY KEY (TIMELINEID)
);

CREATE TABLE TIME_CHUNK (
	CHUNKID			INT		NOT NULL,
	TIMELINEID		INT 		NOT NULL,
	POSITION		INT		NOT NULL,
	STARTTIME		TIME		NOT NULL,
	LOCATIONID		INT,
	DURATION		TIME		DEFAULT '0:0:0',
	DESCRIPTION		TEXT,
	CLIENTID		INT,

	PRIMARY KEY (TIMELINEID, CHUNKID, STARTTIME),
	FOREIGN KEY (TIMELINEID) REFERENCES TIMELINE(TIMELINEID) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (LOCATIONID) REFERENCES LOCATION(LOCATIONID) ON UPDATE CASCADE ON DELETE SET NULL,
	FOREIGN KEY (CLIENTID) REFERENCES CLIENT(CLIENTID) ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE TIMECHUNKPHOTOGRAPHER (
	CHUNKID			INT		NOT NULL,
	TIMELINEID		INT		NOT NULL,
	STARTTIME		TIME		NOT NULL,
	STAFFID			INT		NOT NULL,

	PRIMARY KEY (TIMELINEID, CHUNKID), 
	FOREIGN KEY (TIMELINEID, CHUNKID, STARTTIME) REFERENCES TIME_CHUNK (TIMELINEID, CHUNKID, STARTTIME) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (STAFFID) REFERENCES PHOTOGRAPHER(STAFFID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE PHOTOGRAPHERLOCATIONS (
	STAFFID			INT		NOT NULL,
	TIMELINEID		INT 		NOT NULL,
	CHUNKID			INT		NOT NULL,
	STARTTIME		TIME		NOT NULL,
	LOCATIONID		INT		NOT NULL,

	PRIMARY KEY (STAFFID, TIMELINEID, CHUNKID),
	FOREIGN KEY (STAFFID) REFERENCES PHOTOGRAPHER(STAFFID),
	FOREIGN KEY (TIMELINEID, CHUNKID) REFERENCES TIME_CHUNK(TIMELINEID, CHUNKID) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (LOCATIONID) REFERENCES LOCATION(LOCATIONID) ON UPDATE CASCADE ON DELETE CASCADE
);



 COMMIT;