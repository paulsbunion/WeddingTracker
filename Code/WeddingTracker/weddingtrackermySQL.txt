/* 
	drop potential conflicting indexes and tables
*/

DROP	TABLE	IF EXISTS	PHOTOGRAPHERLOCATIONS;
DROP	TABLE	IF EXISTS	TIME_CHUNK;
DROP	TABLE	IF EXISTS	TIMELINE;
DROP	TABLE	IF EXISTS	CLIENT;
DROP	TABLE	IF EXISTS	ASSIGNED_STAFF;
DROP	TABLE	IF EXISTS	EVENT;
DROP	TABLE	IF EXISTS	EVENTTYPE;
DROP	TABLE	IF EXISTS	LOCATION;
DROP	TABLE	IF EXISTS	PHOTOGRAPHER;

/*
	create the database tables
*/

CREATE TABLE PHOTOGRAPHER (
	ID			INT		NOT NULL		AUTO_INCREMENT,
	FIRSTNAME		VARCHAR(20)	NOT NULL,
	LASTNAME		VARCHAR(25)	NOT NULL,
	
	PRIMARY KEY (ID)
);

CREATE TABLE LOCATION (
	ID			INT		NOT NULL		AUTO_INCREMENT,
	CITY			VARCHAR(30)	NOT NULL,
	STATE			CHAR(2)		NOT NULL		DEFAULT 'OH',
	ZIP			CHAR(5)		NOT NULL,
	ADDRESS			VARCHAR(30)	NOT NULL,
	DESCRIPTION		VARCHAR(100)	NOT NULL		DEFAULT 'N/A',

	PRIMARY KEY (ID)
);

CREATE TABLE EVENTTYPE (
	ID			INT		NOT NULL,
	EVENTTITLE		VARCHAR(100)	NOT NULL		DEFAULT 'EVENT',
	BASECOST		VARCHAR(8)	DEFAULT 'N/A'		NOT NULL,

	PRIMARY KEY (ID)
);

CREATE TABLE EVENT (
	ID			INT		NOT NULL		AUTO_INCREMENT,
	TYPE			INT		NOT NULL,
	DATE			DATE		NOT NULL,
	STARTTIME		TIME		NOT NULL,
	DURATION		TIME		DEFAULT '0:00:00'	NOT NULL,
	LOCATION		INT		NOT NULL,
	TIMELINE		INT		DEFAULT NULL,
		
	MULTICLIENT		CHAR(1)		DEFAULT 'N' 		NOT NULL,
	NOTES			TEXT		NOT NULL,
	
	PRIMARY KEY (ID),
	FOREIGN KEY (TYPE) REFERENCES EVENTTYPE(ID),
	FOREIGN KEY (LOCATION) REFERENCES LOCATION(ID),
	CONSTRAINT CHK_MUL_CLI CHECK (MULTICLIENT = 'Y' OR MULTICLIENT = 'N')
);

CREATE TABLE ASSIGNED_STAFF (
	
	EVENTID			INT		NOT NULL,
	STAFFID			INT		NOT NULL,
	ISEVENTOWNER		CHAR(1) 	NOT NULL,

	PRIMARY KEY (EVENTID, STAFFID),
	FOREIGN KEY (EVENTID) REFERENCES EVENT(ID),
	FOREIGN KEY (STAFFID) REFERENCES PHOTOGRAPHER(ID),		
	CONSTRAINT CHK_OWNER CHECK (ISEVENTOWNER = 'Y' OR ISEVENTOWNER = 'N')
);

CREATE TABLE CLIENT (
	ID			INT		NOT NULL		AUTO_INCREMENT,
	FIRSTNAME		VARCHAR(20)	NOT NULL,
	LASTNAME		VARCHAR(25)	NOT NULL,
	ADDRESS			VARCHAR(100)	NOT NULL,
	PHONENUM		CHAR(14)	NOT NULL,
	EMAIL			VARCHAR(50),
	AUTOREMIND		CHAR(1)		NOT NULL		DEFAULT 'N',

	PRIMARY KEY (ID)
);

CREATE TABLE TIMELINE (
	ID			INT		NOT NULL		AUTO_INCREMENT,
	MULTILOCATION		CHAR(1)		NOT NULL		DEFAULT 'N',
	STARTTIME		TIME		NOT NULL,
	TOTALTIME		TIME,

	PRIMARY KEY (ID)
);

CREATE TABLE TIME_CHUNK (
	ID			INT		NOT NULL		AUTO_INCREMENT,
	STARTTIME		TIME		NOT NULL,
	DURATION		TIME		NOT NULL,

	PRIMARY KEY (ID)
);

CREATE TABLE PHOTOGRAPHERLOCATIONS (
	STAFFID			INT		NOT NULL,
	LOCATION		INT		NOT NULL,
	CHUNKID			INT 		NOT NULL,

	PRIMARY KEY (STAFFID, CHUNKID),
	FOREIGN KEY (STAFFID) REFERENCES PHOTOGRAPHER(ID),
	FOREIGN KEY (LOCATION) REFERENCES LOCATION(ID),
	FOREIGN KEY (CHUNKID) REFERENCES TIME_CHUNK(ID)
);
